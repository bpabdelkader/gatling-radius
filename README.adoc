
= Gatling Plugin for Radius Servers image:https://travis-ci.org/bpabdelkader/gatling-radius.svg?branch=master["Build Status", link="https://travis-ci.org/bpabdelkader/gatling-radius"] image:https://jitpack.io/v/bpabdelkader/gatling-radius.svg["JitPack", link="https://jitpack.io/#bpabdelkader/gatling-radius"]

== Introduction

Gatling Plugin based on tinyradius library for load testing Radius endpoints

This version requires Gatling 3.1.3

== Usage

==== Declare Maven Project dependency 

====== Add the JitPack repository to your build file
```scala
<repositories>
    <repository>
	 <id>jitpack.io</id>
	 <url>https://jitpack.io</url>
    </repository>
</repositories>
```
====== Add the dependency
```scala
<dependency>
    <groupId>com.github.bpabdelkader</groupId>
    <artifactId>gatling-radius</artifactId>
   <version>1.0.0</version>
</dependency>
```
==== Declare Radius Protocol
```scala
implicit val radiusProtocol: RadiusProtocol = radius
	.host("127.0.0.1")
	.sharedKey("mySharedKey")
	.replyTimeout(1000) // replyTimeout in ms
```
==== Declare a test Scenario, which consists in: 
  
====== A data csv feeder with the essential parameters to send Radius requests(Other parameters could be used as well)
```scala
	username,password,NAS-Identifier,NAS-IP-Address,Calling-Station-Id,Called-Station-Id
	username0001,password0001,OPERATOR,1.2.3.4,33012345678,OPERATOR
	username0002,password0002,OPERATOR,1.2.3.4,33012345679,OPERATOR
	username0003,password0003,OPERATOR,1.2.3.4,33012345680,OPERATOR
```
====== Following Radius requests:
```scala
- Authentication Access Request => authenticate()
- Accounting Start		=> accountStart()
- Accounting Interim Update	=> interimUpdate()
- Accounting Stop		=> accountStop()
```

```scala
 val scn = scenario("Access Request")
    .feed(csv("data/dataFeeder.csv").circular)
    .exec(
      radius("Access Request")
        .username("${username}")
        .password("${password}")
        .properties(
          Map(
            "NAS-Identifier" -> "${NAS-Identifier}",
            "NAS-IP-Address" -> "${NAS-IP-Address}",
            "Calling-Station-Id" -> "${Calling-Station-Id}",
            "Called-Station-Id" -> "${Called-Station-Id}",
          ))
        .authenticate())
    .exec(
      radius("Acct Start")
        .username("${username}")
        .properties(
          Map(
            "NAS-Identifier" -> "${NAS-Identifier}",
            "NAS-IP-Address" -> "${NAS-IP-Address}",
            "Calling-Station-Id" -> "${Calling-Station-Id}",
            "Called-Station-Id" -> "${Called-Station-Id}",
          ))
        .accountStart())
    .exec(
      radius("Interim Update")
        .username("${username}")
        .properties(
          Map(
            "NAS-Identifier" -> "${NAS-Identifier}",
            "NAS-IP-Address" -> "${NAS-IP-Address}",
            "Calling-Station-Id" -> "${Calling-Station-Id}",
            "Called-Station-Id" -> "${Called-Station-Id}",
          ))
        .interimUpdate())
    .exec(
      radius("Acct Stop")
        .username("${username}")
        .properties(
          Map(
            "NAS-Identifier" -> "${NAS-Identifier}",
            "NAS-IP-Address" -> "${NAS-IP-Address}",
            "Calling-Station-Id" -> "${Calling-Station-Id}",
            "Called-Station-Id" -> "${Called-Station-Id}",
          ))
        .accountStop())

 setUp(scn.inject(atOnceUsers(1)))
  .protocols(radiusProtocol)
}
```
== Run

Run single simulation implemented in `com.ngenia.radius.RadiusSimulation` class through:

==== maven test profile

```scala
<!-- test profile-->
<profiles>
    <profile>
        <id>test</id>
        <build>
            <plugins>
                <plugin>
                    <groupId>io.gatling</groupId>
                    <artifactId>gatling-maven-plugin</artifactId>
                    <version>3.0.0</version>
                    <configuration>
                        <simulationsFolder>src/test/scala</simulationsFolder>
                        <runMultipleSimulations>false</runMultipleSimulations>
                        <simulationClass>com.ngenia.radius.RadiusSimulation</simulationClass>
                    </configuration>
                    <executions>
                        <execution>
                            <id>run-on-test</id>
                            <phase>test</phase>
                            <goals>
                                <goal>test</goal>
                            </goals>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </build>
    </profile>
</profiles>
```

```scala
$ mvn test -Ptest
  
[INFO] --- gatling-maven-plugin:3.0.0:test (run-on-test) @ gatling-radius ---
Simulation com.ngenia.radius.RadiusSimulation started...
log4j:WARN No appenders could be found for logger (org.tinyradius.util.RadiusClient).
log4j:WARN Please initialize the log4j system properly.

================================================================================
2019-07-01 14:46:27                                           0s elapsed
---- Requests ------------------------------------------------------------------
> Global                                                   (OK=4      KO=0     )
> Access Request                                           (OK=1      KO=0     )
> Acct Start                                               (OK=1      KO=0     )
> Interim Update                                           (OK=1      KO=0     )
> Acct Stop                                                (OK=1      KO=0     )

---- Access Request ------------------------------------------------------------
[##########################################################################]100%
waiting: 0      / active: 0      / done: 1
================================================================================

Simulation com.ngenia.radius.RadiusSimulation completed in 0 seconds
Parsing log file(s)...
Parsing log file(s) done
Generating reports...

================================================================================
---- Global Information --------------------------------------------------------
> request count                                          4 (OK=4      KO=0     )
> min response time                                      0 (OK=0      KO=-     )
> max response time                                     21 (OK=21     KO=-     )
> mean response time                                     5 (OK=5      KO=-     )
> std deviation                                          9 (OK=9      KO=-     )
> response time 50th percentile                          0 (OK=0      KO=-     )
> response time 75th percentile                          5 (OK=5      KO=-     )
> response time 95th percentile                         18 (OK=18     KO=-     )
> response time 99th percentile                         20 (OK=20     KO=-     )
> mean requests/sec                                      4 (OK=4      KO=-     )
---- Response Time Distribution ------------------------------------------------
> t < 800 ms                                             4 (100%)
> 800 ms < t < 1200 ms                                   0 (  0%)
> t > 1200 ms                                            0 (  0%)
> failed                                                 0 (  0%)
================================================================================

Reports generated in 0s.
Please open the following file: \gatling-radius\target\gatling\radiussimulation-20190701124626791\index.html
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 11.982 s
[INFO] Finished at: 2019-07-01T14:46:27+02:00
[INFO] Final Memory: 19M/981M
[INFO] ------------------------------------------------------------------------
```

==== Intellij

RadiusSimulation.class is Runnable, thus the test scenario could be run directly from the intellij test package

image:https://i.postimg.cc/wxXzKGpF/intellij.png["Build Status", link="https://i.postimg.cc/wxXzKGpF/intellij.png"]

== License

Released under the [LGPL License](https://www.gnu.org/licenses/old-licenses/lgpl-2.1.html).